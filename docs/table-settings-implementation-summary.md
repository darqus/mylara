# Сохранение настроек таблиц - Переход на Quasar LocalStorage

## Обновление реализации

Система сохранения настроек таблиц была переписана для использования **Quasar LocalStorage API** вместо нативного localStorage. Это обеспечивает более надежную и кроссплатформенную работу.

### ✅ Composable `useTableSettings`

**Файл**: `src/composables/useTableSettings.ts`

**Функциональность**:

- Автоматическое сохранение настроек таблицы в localStorage
- Загрузка сохраненных настроек при инициализации
- Типизированный интерфейс для работы с настройками
- Graceful обработка ошибок localStorage

**Сохраняемые настройки**:

- Текущая страница пагинации
- Количество записей на странице
- Поле и направление сортировки
- Поисковый фильтр
- Видимые колонки (заготовка для будущего)

### ✅ Новый менеджер настроек `useTableSettingsManager`

**Функциональность**:

- Управление всеми настройками таблиц сразу
- Экспорт/импорт настроек в JSON формате
- Очистка всех настроек одной командой
- Подсчет общего размера данных
- Получение списка всех ключей настроек

### ✅ Компонент TableSettingsManagerPage

**Файл**: `src/pages/admin/TableSettingsManagerPage.vue`

**Функциональность**:

- Визуальный интерфейс для управления настройками
- Экспорт настроек в файл
- Импорт настроек из файла
- Отображение статистики хранилища

**Функциональность**:

- Сохранение ширины колонок
- Управление видимостью колонок
- Отдельное хранение настроек для каждой коллекции

### ✅ Интеграция с AdminCollectionPage

**Файл**: `src/pages/admin/AdminCollectionPage.vue`

**Изменения**:

- Подключен composable useTableSettings
- Автоматическая синхронизация состояния таблицы с настройками
- Восстановление настроек при переключении между коллекциями
- Кнопка сброса настроек к значениям по умолчанию

### ✅ Компонент TableSettingsIndicator

**Файл**: `src/components/admin/TableSettingsIndicator.vue`

**Функциональность**:

- Показывает индикатор наличия сохраненных настроек
- Детальная информация в тултипе
- Отображается только при наличии кастомных настроек

### ✅ Документация

**Файлы**:

- `docs/table-settings-localstorage.md` - подробная документация
- `README-admin.md` - обновлен с информацией о новой функциональности

## Технические особенности

### Автоматическое сохранение

```typescript
// Настройки автоматически сохраняются при изменении
watch(
  settings,
  (newSettings) => {
    saveSettings(newSettings)
  },
  { deep: true }
)
```

### Уникальные ключи для коллекций

```text
table-settings-products    # Настройки для продуктов
table-settings-articles    # Настройки для статей
column-settings-products   # Настройки колонок для продуктов
```

### Типизация

```typescript
export type TableSettings = {
  page: number
  rowsPerPage: number
  sortBy?: string
  descending?: boolean
  filter: string
  visibleColumns?: string[]
}
```

### Обработка ошибок

```typescript
try {
  localStorage.setItem(key, value)
} catch (error) {
  console.warn(`Failed to save settings:`, error)
  // Graceful fallback
}
```

## Пользовательский интерфейс

### Кнопка сброса настроек

- **Расположение**: панель фильтров
- **Иконка**: `settings_backup_restore`
- **Действие**: сбрасывает все настройки к значениям по умолчанию
- **Уведомление**: показывает сообщение об успешном сбросе

### Индикатор настроек

- **Расположение**: рядом с информацией о количестве записей
- **Показывается**: только при наличии кастомных настроек
- **Тултип**: детальная информация о сохраненных настройках

## Преимущества реализации

### Для пользователей

1. **Персонализация**: каждый пользователь может настроить таблицы под себя
2. **Продуктивность**: не нужно заново настраивать при каждом посещении
3. **Удобство**: автоматическое сохранение без дополнительных действий
4. **Прозрачность**: видно, какие настройки сохранены

### Для разработчиков

1. **Переиспользуемость**: composable можно использовать в любых таблицах
2. **Типизация**: полная поддержка TypeScript
3. **Реактивность**: автоматическая синхронизация с Vue.js
4. **Расширяемость**: легко добавлять новые типы настроек

## Использование

### Базовое использование

```vue
<script setup>
import { useTableSettings } from 'src/composables/useTableSettings'

const { settings, updatePagination, updateFilter } =
  useTableSettings('my-collection')

// Настройки автоматически сохраняются при изменении
updatePagination({ page: 2, rowsPerPage: 25 })
updateFilter('search term')
</script>
```

### Интеграция с q-table

```vue
<template>
  <q-table
    v-model:pagination="tableState.pagination"
    @request="onRequest"
  />
</template>

<script setup>
function onRequest(props) {
  // Обновляем настройки при изменении таблицы
  updatePagination(props.pagination)
}
</script>
```

## Будущие возможности

1. **Настройки колонок**: полная реализация управления видимостью и шириной
2. **Экспорт/импорт**: сохранение настроек в файл
3. **Профили**: множественные профили настроек
4. **Синхронизация**: облачная синхронизация между устройствами

## Заключение

Функциональность сохранения настроек таблиц в локальном хранилище успешно реализована и готова к использованию. Она значительно улучшает пользовательский опыт в админ-панели, позволяя персонализировать интерфейс и сохранять предпочтения между сессиями.

## Переход на Quasar LocalStorage

### Ключевые улучшения

1. **Автоматическая сериализация**: не нужно вручную использовать JSON.parse/JSON.stringify
2. **Надежность**: graceful обработка ошибок и недоступности localStorage
3. **Типизация**: лучшая поддержка TypeScript
4. **Удобство**: простой и единообразный API
5. **Расширенные возможности**: проверка наличия, получение всех ключей

### Новые возможности

- **Менеджер настроек**: централизованное управление всеми настройками
- **Экспорт/импорт**: сохранение и восстановление настроек в файл
- **Статистика**: отображение размера данных и количества ключей
- **Batch операции**: массовые операции с настройками

### Обратная совместимость

Переход на Quasar LocalStorage полностью обратно совместим - существующие настройки будут автоматически работать с новым API.
