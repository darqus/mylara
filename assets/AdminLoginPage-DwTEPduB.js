import{r as s,d as O,a as J,a4 as Y,e as B,p as l,J as j,V as G,f as T,s as a,I as W,a3 as X,y as Z,x as r,q as n,a5 as ee,C as D,D as g,a6 as E,a7 as v,B as y,a8 as te,T as k,$ as ae,Y as le}from"./vendor-CqOrBQm9.js";import{u as se,R as C}from"./index-CBE16f4_.js";import"./firebase-vendor-Dt--ACjN.js";function L(){const i=s(!1);function o(){i.value=!i.value}function u(){return i.value?"text":"password"}function w(){return i.value?"o_visibility_off":"o_visibility"}function V(){i.value=!1}return{isPasswordVisible:i,togglePasswordVisibility:o,getInputType:u,getToggleIcon:w,resetPasswordVisibility:V}}const oe={key:0,class:"text-center"},re={class:"q-mt-lg"},de=O({name:"AdminLoginPage",__name:"AdminLoginPage",setup(i){const o=Y(),u=G(),{login:w,register:V,loading:U,isAuthenticated:h,initializing:F}=se(),{togglePasswordVisibility:M,getInputType:N,getToggleIcon:z}=L(),{togglePasswordVisibility:S,getInputType:$,getToggleIcon:H}=L(),b=s(),x=s(),m=s(""),c=s(""),p=s(!1),_=s(""),f=s(!1),K=s(!1),P=s(!1),I=s(""),Q=s("");J(()=>{if(h.value){const d=o.currentRoute.value.query.redirect,e=d&&d!==""?d:C.ADMIN;o.push(e);return}K.value=!0});async function q(){if(!b.value||!await b.value.validate())return;p.value=!1,_.value="";const e=await w(m.value,c.value);if(e.success){u.notify({type:"positive",message:"Вход выполнен успешно",position:"top"});const t=o.currentRoute.value.query.redirect,R=t&&t!==""?t:C.ADMIN;o.push(R)}else p.value=!0,_.value=e.error??"Произошла ошибка при входе",u.notify({type:"negative",message:e.error??"Произошла ошибка при входе",position:"top"})}async function A(){if(!x.value||!await x.value.validate())return;P.value=!0;const e=await V(I.value,Q.value);if(e.success){u.notify({type:"positive",message:"Администратор создан успешно",position:"top"}),f.value=!1;const t=o.currentRoute.value.query.redirect,R=t&&t!==""?t:C.ADMIN;o.push(R)}else u.notify({type:"negative",message:e.error??"Произошла ошибка при создании администратора",position:"top"});P.value=!1}return(d,e)=>(T(),B(j,{view:"lHh Lpr lFf"},{default:l(()=>[a(W,null,{default:l(()=>[a(X,{class:"flex flex-center bg-grey-1"},{default:l(()=>[r(F)?(T(),Z("div",oe,[a(ee,{thickness:.2,class:"q-ma-md",color:"primary",size:"50px",indeterminate:""}),e[6]||(e[6]=n("div",{class:"text-body2 text-grey-8 q-mt-md"},"Инициализация...",-1))])):(T(),B(D,{key:1,class:"q-pa-lg",style:{"min-width":"400px"}},{default:l(()=>[a(g,{class:"text-center"},{default:l(()=>e[7]||(e[7]=[n("div",{class:"text-h4 text-grey-8 q-mb-md"},"Админка",-1),n("div",{class:"text-subtitle1 text-grey-6"}," Вход в панель администратора ",-1)])),_:1,__:[7]}),a(g,null,{default:l(()=>[a(E,{ref_key:"formRef",ref:b,onSubmit:q},{default:l(()=>[a(v,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),error:p.value&&!m.value,autocomplete:"username","error-message":"Введите email",label:"Email",type:"email",clearable:"",filled:""},{prepend:l(()=>[a(y,{name:"o_email"})]),_:1},8,["modelValue","error"]),a(v,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),error:p.value&&!c.value,"error-message":_.value||"Введите пароль",type:r(N)(),autocomplete:"current-password",class:"q-mt-md",label:"Пароль",clearable:"",filled:"",onKeyup:te(q,["enter"])},{prepend:l(()=>[a(y,{name:"o_lock"})]),append:l(()=>[a(y,{name:r(z)(),class:"cursor-pointer",onClick:r(M)},null,8,["name","onClick"])]),_:1},8,["modelValue","error","error-message","type"]),n("div",re,[a(k,{loading:r(U),class:"full-width",color:"primary",label:"Войти",size:"lg",type:"submit"},null,8,["loading"])])]),_:1},512)]),_:1}),a(g,{class:"text-center"},{default:l(()=>e[8]||(e[8]=[n("div",{class:"text-caption text-grey-6"}," Используйте свои учетные данные Firebase Auth ",-1)])),_:1,__:[8]})]),_:1})),a(ae,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),persistent:""},{default:l(()=>[a(D,{style:{"min-width":"400px"}},{default:l(()=>[a(g,null,{default:l(()=>e[9]||(e[9]=[n("div",{class:"text-h6"},"Создание администратора",-1),n("div",{class:"text-caption text-grey-6 q-mt-sm"}," Эта опция доступна только для первоначальной настройки ",-1)])),_:1,__:[9]}),a(g,null,{default:l(()=>[a(E,{ref_key:"registerFormRef",ref:x,onSubmit:A},{default:l(()=>[a(v,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t),rules:[t=>!!t||"Введите email",t=>/.+@.+\..+/.test(t)||"Введите корректный email"],label:"Email администратора",type:"email",filled:""},null,8,["modelValue","rules"]),a(v,{modelValue:Q.value,"onUpdate:modelValue":e[3]||(e[3]=t=>Q.value=t),rules:[t=>!!t||"Введите пароль",t=>t.length>=6||"Пароль должен содержать минимум 6 символов"],type:r($)(),class:"q-mt-md",label:"Пароль",filled:""},{append:l(()=>[a(y,{name:r(H)(),class:"cursor-pointer",onClick:r(S)},null,8,["name","onClick"])]),_:1},8,["modelValue","rules","type"])]),_:1},512)]),_:1}),a(le,{align:"right"},{default:l(()=>[a(k,{label:"Отмена",flat:"",onClick:e[4]||(e[4]=t=>f.value=!1)}),a(k,{loading:P.value,color:"primary",label:"Создать",flat:"",onClick:A},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}});export{de as default};
