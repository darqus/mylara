import{l as u,m as l,n as i,p as h,q as p,t as f,v as b,w as m}from"./firebase-vendor-Dt--ACjN.js";import{d as a,e as y}from"./index-CBE16f4_.js";import"./vendor-CqOrBQm9.js";function d(){const e=y();return e?e.currentUser?{isAuthenticated:!0}:{isAuthenticated:!1,error:"Пользователь не аутентифицирован"}:{isAuthenticated:!1,error:"Firebase Auth не инициализирован"}}const C={async getCollection(e,s="Не удалось загрузить данные"){const c=a();if(!c)return{items:[],error:"Firebase не инициализирован"};try{const o=await m(f(c,e)),r=[];return o.forEach(t=>{const n=t.data();r.push({id:t.id,...n})}),{items:r,error:null}}catch(o){return console.error(`Error fetching ${e} data:`,o),{items:[],error:s}}},async getDocument(e,s,c="Не удалось загрузить данные"){const o=a();if(!o)return{data:null,error:"Firebase не инициализирован"};try{const r=u(o,e,s),t=await b(r);return t.exists()?{data:t.data(),error:null}:{data:null,error:"Документ не найден"}}catch(r){return console.error(`Error fetching ${e}/${s} data:`,r),{data:null,error:c}}},async createDocument(e,s){const c=a();if(!c)return{id:null,error:"Firebase не инициализирован"};const o=d();if(!o.isAuthenticated)return{id:null,error:o.error??"Требуется аутентификация"};try{const r={...s,createdAt:i(),updatedAt:i()};return{id:(await p(f(c,e),r)).id,error:null}}catch(r){return console.error(`Error creating document in ${e}:`,r),r&&typeof r=="object"&&"code"in r&&r.code==="permission-denied"?{id:null,error:"Недостаточно прав для создания документа"}:{id:null,error:"Не удалось создать документ"}}},async updateDocument(e,s,c){const o=a();if(!o)return{success:!1,error:"Firebase не инициализирован"};const r=d();if(!r.isAuthenticated)return{success:!1,error:r.error??"Требуется аутентификация"};try{const t=u(o,e,s),n={...c,updatedAt:i()};return await h(t,n),{success:!0,error:null}}catch(t){return console.error(`Error updating document ${s} in ${e}:`,t),t&&typeof t=="object"&&"code"in t&&t.code==="permission-denied"?{success:!1,error:"Недостаточно прав для обновления документа"}:{success:!1,error:"Не удалось обновить документ"}}},async deleteDocument(e,s){const c=a();if(!c)return{success:!1,error:"Firebase не инициализирован"};const o=d();if(!o.isAuthenticated)return{success:!1,error:o.error??"Требуется аутентификация"};try{const r=u(c,e,s);return await l(r),{success:!0,error:null}}catch(r){return console.error(`Error deleting document ${s} from ${e}:`,r),r&&typeof r=="object"&&"code"in r&&r.code==="permission-denied"?{success:!1,error:"Недостаточно прав для удаления документа"}:{success:!1,error:"Не удалось удалить документ"}}}};export{C as firestoreService};
