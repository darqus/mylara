import{u as e,Q as l,a,b as t,c as n,d as i,e as o,f as r,g as s,h as u,i as d,j as c,k as m,l as v,m as p,n as g,R as f,o as y,p as b,q as h,r as _,s as x,t as w,v as k,w as q,x as V,y as C,z as U,A,B as S}from"./quasar-vendor-BxWwGQLB.js";import{r as z,c as P,d as j,u as B,o as F,a as I,b as T,w as D,e as $,f as L,g as M,h as R,i as O,j as K,k as N,l as E,t as W,m as G,n as H,p as J,F as Q,q as Y,s as X,v as Z}from"./vue-vendor-BCHFu1Z4.js";import{o as ee,c as le,s as ae,a as te,d as ne,b as ie,e as oe,u as re,f as se,g as ue,h as de,i as ce}from"./firebase-vendor-NPot9XFr.js";import{g as me,a as ve,f as pe}from"./services-Kju9QnnT.js";const ge=z(null),fe=z(!1),ye=z(!0);function be(){const e=P((()=>null!==ge.value));return{currentUser:ge,isAuthenticated:e,loading:fe,initializing:ye,login:async function(e,l){const a=me();if(!a)return{success:!1,error:"Firebase Auth не инициализирован"};fe.value=!0;try{const t=await te(a,e,l);return ge.value=t.user,{success:!0}}catch(t){let e="Произошла ошибка при входе";if(t&&"object"==typeof t&&"code"in t)switch(t.code){case"auth/user-not-found":e="Пользователь не найден";break;case"auth/wrong-password":e="Неверный пароль";break;case"auth/invalid-email":e="Неверный формат email";break;case"auth/user-disabled":e="Пользователь заблокирован";break;case"auth/too-many-requests":e="Слишком много попыток входа. Попробуйте позже"}return{success:!1,error:e}}finally{fe.value=!1}},logout:async function(){const e=me();if(!e)return{success:!1,error:"Firebase Auth не инициализирован"};fe.value=!0;try{return await ae(e),ge.value=null,{success:!0}}catch(l){return{success:!1,error:"Произошла ошибка при выходе"}}finally{fe.value=!1}},register:async function(e,l){const a=me();if(!a)return{success:!1,error:"Firebase Auth не инициализирован"};fe.value=!0;try{const t=await le(a,e,l);return ge.value=t.user,{success:!0}}catch(t){let e="Произошла ошибка при регистрации";if(t&&"object"==typeof t&&"code"in t)switch(t.code){case"auth/email-already-in-use":e="Пользователь с таким email уже существует";break;case"auth/invalid-email":e="Неверный формат email";break;case"auth/weak-password":e="Пароль слишком слабый"}return{success:!1,error:e}}finally{fe.value=!1}},checkAuth:function(){return e.value},initAuth:function(){const e=me();e?ee(e,(e=>{ge.value=e,fe.value=!1,ye.value=!1})):ye.value=!1}}}const he=(e,l)=>{const a=e.__vccOpts||e;for(const[t,n]of l)a[t]=n;return a};function _e(){const e=me();return e?e.currentUser?{isAuthenticated:!0}:{isAuthenticated:!1,error:"Пользователь не аутентифицирован"}:{isAuthenticated:!1,error:"Firebase Auth не инициализирован"}}const xe={async getCollection(e,l="Не удалось загрузить данные"){const a=ve();if(!a)return{items:[],error:"Firebase не инициализирован"};try{const l=await ce(ue(a,e)),t=[];return l.forEach((e=>{const l=e.data();t.push({id:e.id,...l})})),{items:t,error:null}}catch(t){return{items:[],error:l}}},async getDocument(e,l,a="Не удалось загрузить данные"){const t=ve();if(!t)return{data:null,error:"Firebase не инициализирован"};try{const a=ne(t,e,l),n=await de(a);if(n.exists()){return{data:n.data(),error:null}}return{data:null,error:"Документ не найден"}}catch(n){return{data:null,error:a}}},async createDocument(e,l){const a=ve();if(!a)return{id:null,error:"Firebase не инициализирован"};const t=_e();if(!t.isAuthenticated)return{id:null,error:t.error??"Требуется аутентификация"};try{const t={...l,createdAt:oe(),updatedAt:oe()};return{id:(await se(ue(a,e),t)).id,error:null}}catch(n){if(n&&"object"==typeof n&&"code"in n){if("permission-denied"===n.code)return{id:null,error:"Недостаточно прав для создания документа"}}return{id:null,error:"Не удалось создать документ"}}},async updateDocument(e,l,a){const t=ve();if(!t)return{success:!1,error:"Firebase не инициализирован"};const n=_e();if(!n.isAuthenticated)return{success:!1,error:n.error??"Требуется аутентификация"};try{const n=ne(t,e,l),i={...a,updatedAt:oe()};return await re(n,i),{success:!0,error:null}}catch(i){if(i&&"object"==typeof i&&"code"in i){if("permission-denied"===i.code)return{success:!1,error:"Недостаточно прав для обновления документа"}}return{success:!1,error:"Не удалось обновить документ"}}},async deleteDocument(e,l){const a=ve();if(!a)return{success:!1,error:"Firebase не инициализирован"};const t=_e();if(!t.isAuthenticated)return{success:!1,error:t.error??"Требуется аутентификация"};try{const t=ne(a,e,l);return await ie(t),{success:!0,error:null}}catch(n){if(n&&"object"==typeof n&&"code"in n){if("permission-denied"===n.code)return{success:!1,error:"Недостаточно прав для удаления документа"}}return{success:!1,error:"Не удалось удалить документ"}}}};function we(){const e=z(!1);return{isPasswordVisible:e,togglePasswordVisibility:function(){e.value=!e.value},getInputType:function(){return e.value?"text":"password"},getToggleIcon:function(){return e.value?"o_visibility_off":"o_visibility"},resetPasswordVisibility:function(){e.value=!1}}}const ke={key:0,class:"text-center"},qe={class:"q-mt-lg"},Ve=j({name:"AdminLoginPage",__name:"AdminLoginPage",setup(v){const p=B(),g=e(),{login:f,register:y,loading:b,isAuthenticated:h,initializing:_}=be(),{togglePasswordVisibility:x,getInputType:w,getToggleIcon:k}=we(),{togglePasswordVisibility:q,getInputType:V,getToggleIcon:C}=we(),U=z(),A=z(),S=z(""),P=z(""),j=z(!1),K=z(""),N=z(!1),E=z(!1),W=z(!1),G=z(""),H=z("");async function J(){if(!U.value)return;if(!(await U.value.validate()))return;j.value=!1,K.value="";const e=await f(S.value,P.value);if(e.success){g.notify({type:"positive",message:"Вход выполнен успешно",position:"top"});const e=p.currentRoute.value.query.redirect??"/admin";p.push(e)}else j.value=!0,K.value=e.error??"Произошла ошибка при входе",g.notify({type:"negative",message:e.error??"Произошла ошибка при входе",position:"top"})}async function Q(){if(!A.value)return;if(!(await A.value.validate()))return;W.value=!0;const e=await y(G.value,H.value);if(e.success){g.notify({type:"positive",message:"Администратор создан успешно",position:"top"}),N.value=!1;const e=p.currentRoute.value.query.redirect??"/admin";p.push(e)}else g.notify({type:"negative",message:e.error??"Произошла ошибка при создании администратора",position:"top"});W.value=!1}return F((()=>{if(h.value){const e=p.currentRoute.value.query.redirect??"/admin";p.push(e)}else E.value=!0})),(e,v)=>(T(),I(m,{view:"lHh Lpr lFf"},{default:D((()=>[$(l,null,{default:D((()=>[$(a,{class:"flex flex-center bg-grey-1"},{default:D((()=>[M(_)?(T(),L("div",ke,[$(t,{thickness:.2,class:"q-ma-md",color:"primary",size:"50px",indeterminate:""}),v[6]||(v[6]=R("div",{class:"text-body2 text-grey-8 q-mt-md"}," Инициализация... ",-1))])):(T(),I(n,{key:1,class:"q-pa-lg",style:{"min-width":"400px"}},{default:D((()=>[$(i,{class:"text-center"},{default:D((()=>v[7]||(v[7]=[R("div",{class:"text-h4 text-grey-8 q-mb-md"}," Админка ",-1),R("div",{class:"text-subtitle1 text-grey-6"}," Вход в панель администратора ",-1)]))),_:1,__:[7]}),$(i,null,{default:D((()=>[$(o,{ref_key:"formRef",ref:U,onSubmit:J},{default:D((()=>[$(r,{modelValue:S.value,"onUpdate:modelValue":v[0]||(v[0]=e=>S.value=e),error:j.value&&!S.value,autocomplete:"username","error-message":"Введите email",label:"Email",type:"email",clearable:"",filled:""},{prepend:D((()=>[$(s,{name:"o_email"})])),_:1},8,["modelValue","error"]),$(r,{modelValue:P.value,"onUpdate:modelValue":v[1]||(v[1]=e=>P.value=e),error:j.value&&!P.value,"error-message":K.value||"Введите пароль",type:M(w)(),autocomplete:"current-password",class:"q-mt-md",label:"Пароль",clearable:"",filled:"",onKeyup:O(J,["enter"])},{prepend:D((()=>[$(s,{name:"o_lock"})])),append:D((()=>[$(s,{name:M(k)(),class:"cursor-pointer",onClick:M(x)},null,8,["name","onClick"])])),_:1},8,["modelValue","error","error-message","type"]),R("div",qe,[$(u,{loading:M(b),class:"full-width",color:"primary",label:"Войти",size:"lg",type:"submit"},null,8,["loading"])])])),_:1},512)])),_:1}),$(i,{class:"text-center"},{default:D((()=>v[8]||(v[8]=[R("div",{class:"text-caption text-grey-6"}," Используйте свои учетные данные Firebase Auth ",-1)]))),_:1,__:[8]})])),_:1})),$(d,{modelValue:N.value,"onUpdate:modelValue":v[5]||(v[5]=e=>N.value=e),persistent:""},{default:D((()=>[$(n,{style:{"min-width":"400px"}},{default:D((()=>[$(i,null,{default:D((()=>v[9]||(v[9]=[R("div",{class:"text-h6"}," Создание администратора ",-1),R("div",{class:"text-caption text-grey-6 q-mt-sm"}," Эта опция доступна только для первоначальной настройки ",-1)]))),_:1,__:[9]}),$(i,null,{default:D((()=>[$(o,{ref_key:"registerFormRef",ref:A,onSubmit:Q},{default:D((()=>[$(r,{modelValue:G.value,"onUpdate:modelValue":v[2]||(v[2]=e=>G.value=e),rules:[e=>!!e||"Введите email",e=>/.+@.+\..+/.test(e)||"Введите корректный email"],label:"Email администратора",type:"email",filled:""},null,8,["modelValue","rules"]),$(r,{modelValue:H.value,"onUpdate:modelValue":v[3]||(v[3]=e=>H.value=e),rules:[e=>!!e||"Введите пароль",e=>e.length>=6||"Пароль должен содержать минимум 6 символов"],type:M(V)(),class:"q-mt-md",label:"Пароль",filled:""},{append:D((()=>[$(s,{name:M(C)(),class:"cursor-pointer",onClick:M(q)},null,8,["name","onClick"])])),_:1},8,["modelValue","rules","type"])])),_:1},512)])),_:1}),$(c,{align:"right"},{default:D((()=>[$(u,{label:"Отмена",flat:"",onClick:v[4]||(v[4]=e=>N.value=!1)}),$(u,{loading:W.value,color:"primary",label:"Создать",flat:"",onClick:Q},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}))}}),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"})),Ue=j({name:"AdminMenuItem",__name:"AdminMenuItem",props:{title:{},icon:{},link:{}},setup(e){const l=e,a=K(),t=P((()=>"/"===l.link&&"/"===a.path||(l.link.includes("/admin/collection/")?a.path===l.link:a.path.startsWith(l.link)&&"/"!==l.link)));return(e,l)=>N((T(),I(v,{active:t.value,to:e.link,"active-class":"text-primary bg-grey-2",clickable:""},{default:D((()=>[$(p,{avatar:""},{default:D((()=>[$(s,{name:e.icon},null,8,["name"])])),_:1}),$(p,null,{default:D((()=>[$(g,null,{default:D((()=>[E(W(e.title),1)])),_:1})])),_:1})])),_:1},8,["active","to"])),[[f]])}}),Ae={carousel:{name:"carousel",label:"Продукты",icon:"inventory_2",searchable:!0,sortable:!0,fields:[{name:"img",label:"Изображение",type:"image",required:!0,placeholder:"Загрузите изображение продукта",imageOptions:{maxSizeKB:3e3,allowedTypes:["image/jpeg","image/jpg","image/png","image/webp"],path:"carousel"}},{name:"info",label:"Информация",type:"text",required:!0,placeholder:"Инновационные технологические решения завтрашнего дня"},{name:"label",label:"Название продукта",type:"textarea",required:!0,placeholder:"Крем - гель подтягивающий для век с ботулоподобным нейропептидом, 30 мл аромат Blanche (по мотивам BYREDO BLANCHE)"},{name:"link",label:"Ссылка",type:"url",required:!0,placeholder:"https://example.com/tech"}],columns:[{name:"img",label:"Изображение",field:"img",align:"center",sortable:!1,format:e=>e||""},{name:"info",label:"Информация",field:"info",required:!0,align:"left",sortable:!0,format:e=>{const l=String(e);return l.length>35?l.substring(0,35)+"...":l}},{name:"label",label:"Название",field:"label",required:!0,align:"left",sortable:!0,format:e=>{const l=String(e);return l.length>30?l.substring(0,30)+"...":l}},{name:"link",label:"Ссылка",field:"link",align:"center",sortable:!1,format:e=>e?"🔗":""},{name:"actions",label:"Действия",field:"actions",align:"center"}]},slides:{name:"slides",label:"Слайды",icon:"slideshow",searchable:!0,sortable:!0,fields:[{name:"img",label:"Изображение",type:"image",required:!0,placeholder:"Загрузите изображение слайда",imageOptions:{maxSizeKB:3e3,allowedTypes:["image/jpeg","image/jpg","image/png","image/webp"],path:"slides"}},{name:"title",label:"Заголовок",type:"text",required:!0,placeholder:"Mountains3"},{name:"subtitle",label:"Подзаголовок",type:"text",required:!0,placeholder:"Majestic peaks and valleys"}],columns:[{name:"img",label:"Изображение",field:"img",align:"center",sortable:!1,format:e=>e||""},{name:"title",label:"Заголовок",field:"title",required:!0,align:"left",sortable:!0},{name:"subtitle",label:"Подзаголовок",field:"subtitle",required:!0,align:"left",sortable:!0,format:e=>{const l=String(e);return l.length>40?l.substring(0,40)+"...":l}},{name:"actions",label:"Действия",field:"actions",align:"center"}]},slogan:{name:"slogan",label:"Слоган",icon:"campaign",searchable:!0,sortable:!1,fields:[{name:"title",label:"Текст слогана",type:"textarea",required:!0,placeholder:"4673771782657 тоник-лосьон для лица Lorem ipsum dolor sit amet..."}],columns:[{name:"title",label:"Текст слогана",field:"title",required:!0,align:"left",sortable:!1,format:e=>{const l=String(e);return l.length>100?l.substring(0,100)+"...":l}},{name:"actions",label:"Действия",field:"actions",align:"center"}]}},Se=()=>Object.values(Ae),ze={key:0,class:"q-mr-md text-caption"},Pe=j({name:"AdminLayout",__name:"AdminLayout",setup(a){const t=B(),n=e(),{currentUser:i,isAuthenticated:o,logout:r}=be(),s=z(!1),d=Se();function c(){s.value=!s.value}async function v(){const e=await r();e.success?(n.notify({type:"positive",message:"Выход выполнен успешно",position:"top"}),t.push("/admin/login")):n.notify({type:"negative",message:e.error??"Произошла ошибка при выходе",position:"top"})}return G((()=>o.value),(e=>{e||t.push("/admin/login")}),{immediate:!0}),(e,a)=>{const t=H("router-view");return T(),I(m,{view:"lHh Lpr lFf"},{default:D((()=>[$(y,{elevated:""},{default:D((()=>[$(b,null,{default:D((()=>[$(u,{"aria-label":"Menu",icon:"menu",dense:"",flat:"",round:"",onClick:c}),$(h,null,{default:D((()=>a[1]||(a[1]=[E(" Админка ")]))),_:1,__:[1]}),M(i)?(T(),L("div",ze,W(M(i).email),1)):J("",!0),$(u,{icon:"logout",dense:"",flat:"",round:"",onClick:v},{default:D((()=>[$(_,null,{default:D((()=>a[2]||(a[2]=[E("Выйти")]))),_:1,__:[2]})])),_:1}),R("div",{class:"q-ml-md"}," Версия "+W("1.0.0"))])),_:1})])),_:1}),$(x,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),bordered:"","show-if-above":""},{default:D((()=>[$(w,null,{default:D((()=>[$(g,{header:""},{default:D((()=>a[3]||(a[3]=[E(" Управление данными ")]))),_:1,__:[3]}),(T(!0),L(Q,null,Y(M(d),(e=>(T(),I(Ue,{key:e.name,icon:e.icon,link:`/admin/collection/${e.name}`,title:e.label},null,8,["icon","link","title"])))),128)),$(k),$(Ue,{icon:"home",link:"/",title:"На главную"})])),_:1})])),_:1},8,["modelValue"]),$(l,null,{default:D((()=>[$(t)])),_:1})])),_:1})}}}),je=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"})),Be={key:0,class:"text-center q-py-lg"},Fe={key:1,class:"row q-gutter-md"},Ie={class:"text-h4 text-weight-bold"},Te={class:"text-body2 text-grey-6"},De=j({name:"AdminStatsWidget",__name:"AdminStatsWidget",setup(e){const l=z(!0),a=z([]);function t(e){const l=["primary","secondary","accent","positive","negative","info","warning"];return l[e.length%l.length]??"primary"}return F((async()=>{await async function(){l.value=!0;try{const e=Se().map((async e=>{const l=await xe.getCollection(e.name);return{name:e.name,label:e.label,icon:e.icon,color:t(e.name),count:l.items.length}}));a.value=await Promise.all(e)}finally{l.value=!1}}()})),(e,t)=>(T(),I(n,null,{default:D((()=>[$(i,null,{default:D((()=>[t[1]||(t[1]=R("div",{class:"text-h6 q-mb-md"}," Статистика коллекций ",-1)),l.value?(T(),L("div",Be,[$(q,{color:"primary",size:"2em"}),t[0]||(t[0]=R("div",{class:"q-mt-md text-grey-6"}," Загрузка статистики... ",-1))])):(T(),L("div",Fe,[(T(!0),L(Q,null,Y(a.value,(e=>(T(),L("div",{key:e.name,class:"col-12 col-sm-6 col-md-4"},[$(n,{class:"text-center q-pa-md",bordered:"",flat:""},{default:D((()=>[$(s,{color:e.color,name:e.icon,class:"q-mb-sm",size:"32px"},null,8,["color","name"]),R("div",Ie,W(e.count),1),R("div",Te,W(e.label),1)])),_:2},1024)])))),128))]))])),_:1,__:[1]})])),_:1}))}}),$e={class:"row q-gutter-md"},Le={class:"text-h6"},Me={class:"text-body2 text-grey-6"},Re={class:"row q-gutter-md"},Oe=he(j({name:"AdminDashboardPage",__name:"AdminDashboardPage",setup(l){const t=e(),o=B(),m=Se(),v=z(!1),p=z("");function g(){t.notify({type:"positive",message:"Данные обновлены",position:"top"})}function y(){p.value.trim()?(t.notify({type:"info",message:`Создание коллекции "${p.value}" (в разработке)`,position:"top"}),v.value=!1,p.value=""):t.notify({type:"negative",message:"Введите название коллекции",position:"top"})}return(e,l)=>(T(),I(a,{class:"q-pa-md"},{default:D((()=>[l[5]||(l[5]=R("div",{class:"text-h4 q-mb-md"}," Панель администратора ",-1)),l[6]||(l[6]=R("div",{class:"text-subtitle1 q-mb-lg text-grey-7"}," Добро пожаловать в админку для управления базой данных ",-1)),$(De,{class:"q-mb-lg"}),R("div",$e,[(T(!0),L(Q,null,Y(M(m),(e=>(T(),L("div",{key:e.name,class:"col-12 col-sm-6 col-md-4"},[N((T(),I(n,{class:"admin-card cursor-pointer",clickable:"",onClick:l=>{return a=e.name,void o.push(`/admin/collection/${a}`);var a}},{default:D((()=>[$(i,{class:"text-center"},{default:D((()=>[$(s,{name:e.icon,class:"q-mb-md",color:"primary",size:"48px"},null,8,["name"]),R("div",Le,W(e.label),1),R("div",Me," Управление записями "+W(e.label.toLowerCase()),1)])),_:2},1024)])),_:2},1032,["onClick"])),[[f]])])))),128))]),$(k,{class:"q-my-lg"}),l[7]||(l[7]=R("div",{class:"text-h6 q-mb-md"}," Быстрые действия ",-1)),R("div",Re,[$(u,{color:"primary",icon:"add",label:"Создать коллекцию",onClick:l[0]||(l[0]=e=>v.value=!0)}),$(u,{color:"secondary",icon:"refresh",label:"Обновить данные",onClick:g})]),$(d,{modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=e=>v.value=e)},{default:D((()=>[$(n,{style:{"min-width":"400px"}},{default:D((()=>[$(i,null,{default:D((()=>l[4]||(l[4]=[R("div",{class:"text-h6"}," Создать новую коллекцию ",-1)]))),_:1,__:[4]}),$(i,{class:"q-pt-none"},{default:D((()=>[$(r,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=e=>p.value=e),label:"Название коллекции",placeholder:"Введите название коллекции",filled:""},null,8,["modelValue"])])),_:1}),$(c,{align:"right",class:"text-primary"},{default:D((()=>[$(u,{label:"Отмена",flat:"",onClick:l[2]||(l[2]=e=>v.value=!1)}),$(u,{label:"Создать",flat:"",onClick:y})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1,__:[5,6,7]}))}}),[["__scopeId","data-v-5158d40b"]]),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"})),Ne={class:"image-uploader"},Ee=["disabled"],We={key:0,class:"image-preview"},Ge={class:"image-info"},He={class:"text-caption text-grey-7"},Je={class:"text-caption text-grey-6"},Qe={key:1,class:"upload-placeholder"},Ye={class:"text-caption text-grey-5"},Xe={key:2,class:"upload-overlay"},Ze={class:"text-body2 text-grey-8"},el={key:0,class:"text-negative q-mt-sm"},ll=he(j({name:"ImageUploader",__name:"ImageUploader",props:{modelValue:{default:null},disabled:{type:Boolean,default:!1},maxSizeKB:{default:5e3},allowedTypes:{default:()=>["image/jpeg","image/jpg","image/png","image/gif","image/webp"]},path:{default:"images"},placeholder:{default:""}},emits:["update:modelValue","upload-start","upload-success","upload-error"],setup(e,{emit:l}){const a=e,n=l,i=z(),o=z(!1),r=z(!1),d=z(0),c=z(""),m=z(null),v=z(""),p=z(0),g=P({get:()=>a.modelValue,set:e=>n("update:modelValue",e)});function f(){!a.disabled&&i.value&&i.value.click()}function y(e){const l=e.target,a=l.files?.[0];a&&k(a)}function b(){a.disabled||(o.value=!0)}function h(){a.disabled||(o.value=!0)}function x(){o.value=!1}function w(e){if(o.value=!1,a.disabled)return;const l=e.dataTransfer?.files[0];l&&l.type.startsWith("image/")&&k(l)}async function k(e){c.value="",r.value=!0,d.value=0,function(e){const l=new FileReader;l.onload=l=>{m.value=l.target?.result,v.value=e.name,p.value=e.size},l.readAsDataURL(e)}(e),n("upload-start");const l={path:a.path,maxSizeKB:a.maxSizeKB,allowedTypes:a.allowedTypes};try{const a=await pe.uploadImageWithProgress(e,l,(e=>{d.value=e.percentage}));a.error?(c.value=a.error,n("upload-error",a.error),q()):a.url&&(g.value=a.url,n("upload-success",a.url))}finally{r.value=!1,d.value=0}}function q(){m.value=null,v.value="",p.value=0}async function C(){if(g.value){try{await pe.deleteImageByUrl(g.value)}catch(e){}g.value=null,q(),c.value=""}}function U(e){if(0===e)return"0 Bytes";const l=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,l)).toFixed(2))} ${["Bytes","KB","MB","GB"][l]}`}return G((()=>a.modelValue),(e=>{e&&e!==m.value?(m.value=e,v.value=function(e){try{const l=new URL(e),a=l.pathname.split("/");return a[a.length-1]??"image"}catch{return"image"}}(e),p.value=0):e||q()}),{immediate:!0}),(e,l)=>(T(),L("div",Ne,[R("div",{class:Z([{"upload-area--dragover":o.value,"upload-area--disabled":e.disabled},"upload-area"]),onClick:f,onDragenter:X(b,["prevent"]),onDragleave:X(x,["prevent"]),onDragover:X(h,["prevent"]),onDrop:X(w,["prevent"])},[R("input",{ref_key:"fileInput",ref:i,disabled:e.disabled,accept:"image/*",style:{display:"none"},type:"file",onChange:y},null,40,Ee),m.value?(T(),L("div",We,[$(V,{alt:v.value,src:m.value,class:"rounded-borders",style:{"max-width":"100%","max-height":"200px"}},null,8,["alt","src"]),R("div",Ge,[R("div",He,W(v.value),1),R("div",Je,W(U(p.value)),1)]),e.disabled?J("",!0):(T(),I(u,{key:0,class:"image-remove-btn",color:"negative",icon:"close",size:"sm",dense:"",round:"",onClick:X(C,["stop"])},{default:D((()=>[$(_,null,{default:D((()=>l[0]||(l[0]=[E("Удалить изображение")]))),_:1,__:[0]})])),_:1}))])):(T(),L("div",Qe,[$(s,{color:"grey-5",name:"cloud_upload",size:"48px"}),l[1]||(l[1]=R("div",{class:"text-h6 text-grey-7 q-mt-sm"}," Загрузить изображение ",-1)),l[2]||(l[2]=R("div",{class:"text-caption text-grey-6"}," Перетащите файл сюда или нажмите для выбора ",-1)),l[3]||(l[3]=R("div",{class:"text-caption text-grey-5 q-mt-sm"}," Поддерживаемые форматы: JPG, PNG, GIF, WebP ",-1)),R("div",Ye," Максимальный размер: "+W(U(1024*(e.maxSizeKB??5e3))),1)])),r.value?(T(),L("div",Xe,[$(t,{thickness:.2,value:d.value,class:"q-ma-md",color:"primary",size:"50px","track-color":"grey-3"},null,8,["value"]),R("div",Ze," Загрузка... "+W(d.value)+"% ",1)])):J("",!0)],34),c.value?(T(),L("div",el,[$(s,{class:"q-mr-xs",name:"error"}),E(" "+W(c.value),1)])):J("",!0)]))}}),[["__scopeId","data-v-c2e166eb"]]),al={class:"text-h6"},tl={class:"row"},nl={key:5,class:"q-mb-md"},il={class:"text-subtitle2 q-mb-sm"},ol={key:0,class:"text-negative"},rl=j({name:"AdminFormDialog",__name:"AdminFormDialog",props:{modelValue:{type:Boolean},config:{},item:{},loading:{type:Boolean}},emits:["update:modelValue","save","cancel"],setup(e,{emit:l}){const a=e,t=l,s=z(),m=z({}),v=P((()=>Boolean(a.item?.id)));function p(){m.value={},a.config?.fields&&a.config.fields.forEach((e=>{switch(e.type){case"boolean":m.value[e.name]=!1;break;case"number":m.value[e.name]=0;break;default:m.value[e.name]=""}}))}function g(e){const l=[];return e.required&&l.push((l=>"boolean"===e.type||(null!=l&&""!==String(l).trim()||"Поле обязательно для заполнения"))),"email"===e.type&&l.push((e=>{if(!e)return!0;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e))||"Введите корректный email"})),"url"===e.type&&l.push((e=>{if(!e)return!0;try{return new URL(String(e)),!0}catch{return"Введите корректный URL"}})),e.rules&&l.push(...e.rules),l}async function f(){if(!s.value)return;if(!(await s.value.validate()))return;const e={...m.value};v.value||(delete e.id,delete e.createdAt,delete e.updatedAt),t("save",e)}return G((()=>a.item),(e=>{e?m.value={...e}:p()}),{immediate:!0}),G((()=>a.modelValue),(e=>{e||p()})),(e,l)=>(T(),I(d,{"model-value":e.modelValue,"onUpdate:modelValue":l[1]||(l[1]=l=>e.$emit("update:modelValue",l))},{default:D((()=>[$(n,{style:{"min-width":"500px","max-width":"800px"}},{default:D((()=>[$(i,null,{default:D((()=>[R("div",al,W(v.value?"Редактировать запись":"Создать запись"),1)])),_:1}),$(i,{class:"q-pt-none"},{default:D((()=>[$(o,{ref_key:"formRef",ref:s,onSubmit:f},{default:D((()=>[R("div",tl,[(T(!0),L(Q,null,Y(e.config?.fields||[],(e=>{return T(),L("div",{key:e.name,class:"col-12"},[["text","email","url"].includes(e.type)?(T(),I(r,{key:0,label:e.label,"model-value":String(m.value[e.name]||""),placeholder:e.placeholder,required:e.required,rules:g(e),type:(l=e.type,"email"===l?"email":"url"===l?"url":"text"),filled:"","onUpdate:modelValue":l=>m.value[e.name]=l},null,8,["label","model-value","placeholder","required","rules","type","onUpdate:modelValue"])):"number"===e.type?(T(),I(r,{key:1,label:e.label,"model-value":Number(m.value[e.name]||0),placeholder:e.placeholder,required:e.required,rules:g(e),type:"number",filled:"","onUpdate:modelValue":l=>m.value[e.name]=Number(l)},null,8,["label","model-value","placeholder","required","rules","onUpdate:modelValue"])):"textarea"===e.type?(T(),I(r,{key:2,label:e.label,"model-value":String(m.value[e.name]||""),placeholder:e.placeholder,required:e.required,rules:g(e),rows:"4",type:"textarea",filled:"","onUpdate:modelValue":l=>m.value[e.name]=l},null,8,["label","model-value","placeholder","required","rules","onUpdate:modelValue"])):"date"===e.type?(T(),I(r,{key:3,label:e.label,"model-value":String(m.value[e.name]||""),required:e.required,rules:g(e),type:"date",filled:"","onUpdate:modelValue":l=>m.value[e.name]=l},null,8,["label","model-value","required","rules","onUpdate:modelValue"])):"boolean"===e.type?(T(),I(C,{key:4,label:e.label,"model-value":Boolean(m.value[e.name]),"onUpdate:modelValue":l=>m.value[e.name]=l},null,8,["label","model-value","onUpdate:modelValue"])):"image"===e.type?(T(),L("div",nl,[R("div",il,[E(W(e.label)+" ",1),e.required?(T(),L("span",ol,"*")):J("",!0)]),$(ll,{"model-value":m.value[e.name]?String(m.value[e.name]):null,"onUpdate:modelValue":l=>m.value[e.name]=l},null,8,["model-value","onUpdate:modelValue"])])):J("",!0)]);var l})),128))])])),_:1},512)])),_:1}),$(c,{align:"right",class:"text-primary"},{default:D((()=>[$(u,{color:"grey-6",label:"Отмена",outline:"",onClick:l[0]||(l[0]=l=>e.$emit("cancel"))}),$(u,{loading:e.loading,color:"positive",label:"Сохранить",outline:"",onClick:f},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),sl={class:"image-cell"},ul={class:"image-overlay"},dl={class:"image-error"},cl={key:1,class:"image-placeholder"},ml={class:"image-error-full"},vl=he(j({name:"ImageTableCell",__name:"ImageTableCell",props:{imageUrl:{default:null},alt:{default:"Image"},size:{default:40}},setup(e){const l=e,a=z(!1);function t(){l.imageUrl&&(a.value=!0)}function o(){if(!l.imageUrl)return;const e=document.createElement("a");e.href=l.imageUrl,e.download=l.alt||"image",e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)}return(e,l)=>(T(),L("div",sl,[e.imageUrl?(T(),I(V,{key:0,alt:e.alt,src:e.imageUrl,class:"image-thumbnail",fit:"cover",loading:"lazy",onClick:t},{error:D((()=>[R("div",dl,[$(s,{color:"grey-5",name:"broken_image",size:"24px"})])])),default:D((()=>[R("div",ul,[$(s,{color:"white",name:"zoom_in",size:"20px"})])])),_:1},8,["alt","src"])):(T(),L("div",cl,[$(s,{color:"grey-5",name:"image",size:"24px"})])),$(d,{modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value=e)},{default:D((()=>[$(n,{class:"image-dialog"},{default:D((()=>[$(i,{class:"q-pa-none"},{default:D((()=>[$(V,{alt:e.alt,src:e.imageUrl||void 0,fit:"contain",style:{"max-height":"80vh","max-width":"80vw"}},{error:D((()=>[R("div",ml,[$(s,{color:"grey-5",name:"broken_image",size:"48px"}),l[2]||(l[2]=R("div",{class:"text-grey-7 q-mt-sm"}," Ошибка загрузки изображения ",-1))])])),_:1},8,["alt","src"])])),_:1}),$(c,{align:"right"},{default:D((()=>[$(u,{label:"Закрыть",flat:"",onClick:l[0]||(l[0]=e=>a.value=!1)}),e.imageUrl?(T(),I(u,{key:0,color:"primary",icon:"download",label:"Скачать",flat:"",onClick:o})):J("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])]))}}),[["__scopeId","data-v-578347f2"]]),pl={class:"row items-center justify-between q-mb-md"},gl={class:"text-h4"},fl={class:"row q-gutter-md items-center"},yl={class:"col-12 col-md-6"},bl={class:"col-auto"},hl={key:0,class:"col-auto"},_l={class:"col-auto text-grey-6"},xl={class:"full-width row flex-center text-grey-7 q-gutter-sm"},wl={class:"q-ml-sm"},kl=j({name:"AdminCollectionPage",__name:"AdminCollectionPage",setup(l){const t=e(),o=K(),m=P((()=>o.params.collection)),v=P((()=>{return e=m.value,Ae[e];var e})),p=z({items:[],loading:!1,pagination:{page:1,rowsPerPage:10,rowsNumber:0},filter:"",selected:[]}),g=z([]),f=z([]),y=z(!1),b=z(!1),h=z(!1),x=z(null),w=z(null),k=P((()=>p.value.filter.trim()?`Найдено: ${f.value.length} из ${g.value.length}`:`Всего записей: ${g.value.length}`)),q=P((()=>p.value.selected.length>1?`Вы действительно хотите удалить ${p.value.selected.length} записей?`:"Вы действительно хотите удалить эту запись?"));function V(e){if(!e.trim())return f.value=[...g.value],p.value.items=f.value,void(p.value.pagination.rowsNumber=f.value.length);const l=e.toLowerCase(),a=v.value?.fields?.map((e=>e.name))??[];f.value=g.value.filter((e=>a.some((a=>{const t=e[a];if(null==t)return!1;return String(t).toLowerCase().includes(l)})))),p.value.items=f.value,p.value.pagination.rowsNumber=f.value.length,p.value.pagination.page=1}function C(){p.value.filter="",V("")}async function j(){if(v.value){p.value.loading=!0;try{const e=await xe.getCollection(m.value);e.error?t.notify({type:"negative",message:e.error,position:"top"}):(g.value=e.items,V(p.value.filter))}finally{p.value.loading=!1}}else t.notify({type:"negative",message:"Конфигурация коллекции не найдена",position:"top"})}function B(e){const{page:l,rowsPerPage:a}=e.pagination;p.value.pagination.page=l,p.value.pagination.rowsPerPage=a}function M(){b.value=!0}async function O(e){h.value=!0;try{if(x.value?.id){const l=await xe.updateDocument(m.value,x.value.id,e);l.error?t.notify({type:"negative",message:l.error,position:"top"}):(t.notify({type:"positive",message:"Запись успешно обновлена",position:"top"}),await j(),N())}else{const l=await xe.createDocument(m.value,e);l.error?t.notify({type:"negative",message:l.error,position:"top"}):(t.notify({type:"positive",message:"Запись успешно создана",position:"top"}),await j(),N())}}finally{h.value=!1}}function N(){y.value=!1,x.value=null}async function H(){const e=p.value.selected.length>0?p.value.selected:w.value?[w.value]:[];if(0!==e.length)try{const l=e.map((e=>xe.deleteDocument(m.value,e.id))),a=await Promise.all(l);a.some((e=>e.error))?t.notify({type:"negative",message:"Произошла ошибка при удалении некоторых записей",position:"top"}):t.notify({type:"positive",message:`Успешно удалено ${e.length} записей`,position:"top"}),await j()}finally{b.value=!1,p.value.selected=[],w.value=null}}return F((()=>{j()})),G((()=>m.value),((e,l)=>{e!==l&&e&&(p.value={items:[],loading:!0,pagination:{page:1,rowsPerPage:10,rowsNumber:0},filter:"",selected:[]},g.value=[],f.value=[],y.value=!1,b.value=!1,x.value=null,w.value=null,l&&v.value?.label&&t.notify({type:"info",message:`Переключено на: ${v.value.label}`,position:"top",timeout:1e3}),j())})),(e,l)=>(T(),I(a,{class:"q-pa-md"},{default:D((()=>[R("div",pl,[R("div",null,[R("div",gl,W(v.value?.label||m.value),1),l[8]||(l[8]=R("div",{class:"text-subtitle1 text-grey-7"}," Управление записями в коллекции ",-1))]),$(u,{color:"primary",icon:"add",label:"Создать запись",onClick:l[0]||(l[0]=e=>y.value=!0)})]),$(n,{class:"q-mb-md",bordered:"",flat:""},{default:D((()=>[$(i,null,{default:D((()=>[R("div",fl,[R("div",yl,[$(r,{modelValue:p.value.filter,"onUpdate:modelValue":[l[1]||(l[1]=e=>p.value.filter=e),l[2]||(l[2]=e=>V(String(e||"")))],debounce:"300",label:"Поиск",placeholder:"Поиск по всем полям...",clearable:"",filled:"",onClear:C},{append:D((()=>[$(s,{name:"search"})])),_:1},8,["modelValue"])]),R("div",bl,[$(u,{color:"secondary",icon:"refresh",padding:"12px",size:"md",onClick:j})]),p.value.selected.length>0?(T(),L("div",hl,[$(u,{label:`Удалить (${p.value.selected.length})`,color:"negative",icon:"delete",padding:"12px",size:"md",onClick:M},null,8,["label"])])):J("",!0),R("div",_l,W(k.value),1)])])),_:1})])),_:1}),$(U,{pagination:p.value.pagination,"onUpdate:pagination":l[3]||(l[3]=e=>p.value.pagination=e),selected:p.value.selected,"onUpdate:selected":l[4]||(l[4]=e=>p.value.selected=e),columns:v.value?.columns||[],loading:p.value.loading,rows:p.value.items,"row-key":"id",selection:"multiple",onRequest:B},{"body-cell-actions":D((e=>[$(A,{props:e},{default:D((()=>[$(u,{color:"primary",icon:"edit",dense:"",flat:"",round:"",onClick:l=>{return a=e.row,x.value={...a},void(y.value=!0);var a}},{default:D((()=>[$(_,null,{default:D((()=>l[9]||(l[9]=[E("Редактировать")]))),_:1,__:[9]})])),_:2},1032,["onClick"]),$(u,{color:"negative",icon:"delete",dense:"",flat:"",round:"",onClick:l=>{return a=e.row,w.value=a,p.value.selected=[a],void(b.value=!0);var a}},{default:D((()=>[$(_,null,{default:D((()=>l[10]||(l[10]=[E("Удалить")]))),_:1,__:[10]})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),"body-cell-img":D((e=>[$(A,{props:e},{default:D((()=>[$(vl,{alt:`Изображение ${e.row.id}`,"image-url":e.value},null,8,["alt","image-url"])])),_:2},1032,["props"])])),"no-data":D((()=>[R("div",xl,[$(s,{name:"inbox",size:"2em"}),l[11]||(l[11]=R("span",null," Нет данных для отображения ",-1))])])),_:1},8,["pagination","selected","columns","loading","rows"]),$(rl,{modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=e=>y.value=e),config:v.value,item:x.value,loading:h.value,onCancel:N,onSave:O},null,8,["modelValue","config","item","loading"]),$(d,{modelValue:b.value,"onUpdate:modelValue":l[7]||(l[7]=e=>b.value=e)},{default:D((()=>[$(n,null,{default:D((()=>[$(i,{class:"row items-center"},{default:D((()=>[$(S,{color:"negative",icon:"warning","text-color":"white"}),R("span",wl,W(q.value),1)])),_:1}),$(c,{align:"right"},{default:D((()=>[$(u,{label:"Отмена",flat:"",onClick:l[6]||(l[6]=e=>b.value=!1)}),$(u,{color:"negative",label:"Удалить",flat:"",onClick:H})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}))}}),ql=Object.freeze(Object.defineProperty({__proto__:null,default:kl},Symbol.toStringTag,{value:"Module"}));export{Ce as A,he as _,je as a,Ke as b,ql as c,xe as f,be as u};
