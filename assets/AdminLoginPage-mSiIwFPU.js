import{r as s,d as H,a1 as O,R as W,a as j,e as A,f as C,p as l,q as a,B as G,a0 as J,D as X,y as r,s as n,a2 as Y,P as L,T as m,a3 as B,a4 as v,L as y,a5 as Z,K as T,W as ee,U as te,C as ae}from"./vendor-CZl8qdfD.js";import{u as le}from"./index-O5WQvQvg.js";import"./firebase-vendor-DtqfmKDn.js";function U(){const i=s(!1);function o(){i.value=!i.value}function u(){return i.value?"text":"password"}function w(){return i.value?"o_visibility_off":"o_visibility"}function V(){i.value=!1}return{isPasswordVisible:i,togglePasswordVisibility:o,getInputType:u,getToggleIcon:w,resetPasswordVisibility:V}}const se={key:0,class:"text-center"},oe={class:"q-mt-lg"},ue=H({name:"AdminLoginPage",__name:"AdminLoginPage",setup(i){const o=O(),u=W(),{login:w,register:V,loading:h,isAuthenticated:E,initializing:F}=le(),{togglePasswordVisibility:z,getInputType:D,getToggleIcon:K}=U(),{togglePasswordVisibility:S,getInputType:M,getToggleIcon:N}=U(),b=s(),x=s(),g=s(""),c=s(""),p=s(!1),_=s(""),f=s(!1),$=s(!1),P=s(!1),Q=s(""),k=s("");j(()=>{if(E.value){const d=o.currentRoute.value.query.redirect,e=d&&d!==""?d:"/admin";o.push(e);return}$.value=!0});async function q(){if(!b.value||!await b.value.validate())return;p.value=!1,_.value="";const e=await w(g.value,c.value);if(e.success){u.notify({type:"positive",message:"Вход выполнен успешно",position:"top"});const t=o.currentRoute.value.query.redirect,R=t&&t!==""?t:"/admin";o.push(R)}else p.value=!0,_.value=e.error??"Произошла ошибка при входе",u.notify({type:"negative",message:e.error??"Произошла ошибка при входе",position:"top"})}async function I(){if(!x.value||!await x.value.validate())return;P.value=!0;const e=await V(Q.value,k.value);if(e.success){u.notify({type:"positive",message:"Администратор создан успешно",position:"top"}),f.value=!1;const t=o.currentRoute.value.query.redirect,R=t&&t!==""?t:"/admin";o.push(R)}else u.notify({type:"negative",message:e.error??"Произошла ошибка при создании администратора",position:"top"});P.value=!1}return(d,e)=>(C(),A(ae,{view:"lHh Lpr lFf"},{default:l(()=>[a(G,null,{default:l(()=>[a(J,{class:"flex flex-center bg-grey-1"},{default:l(()=>[r(F)?(C(),X("div",se,[a(Y,{thickness:.2,class:"q-ma-md",color:"primary",size:"50px",indeterminate:""}),e[6]||(e[6]=n("div",{class:"text-body2 text-grey-8 q-mt-md"}," Инициализация... ",-1))])):(C(),A(L,{key:1,class:"q-pa-lg",style:{"min-width":"400px"}},{default:l(()=>[a(m,{class:"text-center"},{default:l(()=>e[7]||(e[7]=[n("div",{class:"text-h4 text-grey-8 q-mb-md"}," Админка ",-1),n("div",{class:"text-subtitle1 text-grey-6"}," Вход в панель администратора ",-1)])),_:1,__:[7]}),a(m,null,{default:l(()=>[a(B,{ref_key:"formRef",ref:b,onSubmit:q},{default:l(()=>[a(v,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),error:p.value&&!g.value,autocomplete:"username","error-message":"Введите email",label:"Email",type:"email",clearable:"",filled:""},{prepend:l(()=>[a(y,{name:"o_email"})]),_:1},8,["modelValue","error"]),a(v,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),error:p.value&&!c.value,"error-message":_.value||"Введите пароль",type:r(D)(),autocomplete:"current-password",class:"q-mt-md",label:"Пароль",clearable:"",filled:"",onKeyup:Z(q,["enter"])},{prepend:l(()=>[a(y,{name:"o_lock"})]),append:l(()=>[a(y,{name:r(K)(),class:"cursor-pointer",onClick:r(z)},null,8,["name","onClick"])]),_:1},8,["modelValue","error","error-message","type"]),n("div",oe,[a(T,{loading:r(h),class:"full-width",color:"primary",label:"Войти",size:"lg",type:"submit"},null,8,["loading"])])]),_:1},512)]),_:1}),a(m,{class:"text-center"},{default:l(()=>e[8]||(e[8]=[n("div",{class:"text-caption text-grey-6"}," Используйте свои учетные данные Firebase Auth ",-1)])),_:1,__:[8]})]),_:1})),a(ee,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),persistent:""},{default:l(()=>[a(L,{style:{"min-width":"400px"}},{default:l(()=>[a(m,null,{default:l(()=>e[9]||(e[9]=[n("div",{class:"text-h6"}," Создание администратора ",-1),n("div",{class:"text-caption text-grey-6 q-mt-sm"}," Эта опция доступна только для первоначальной настройки ",-1)])),_:1,__:[9]}),a(m,null,{default:l(()=>[a(B,{ref_key:"registerFormRef",ref:x,onSubmit:I},{default:l(()=>[a(v,{modelValue:Q.value,"onUpdate:modelValue":e[2]||(e[2]=t=>Q.value=t),rules:[t=>!!t||"Введите email",t=>/.+@.+\..+/.test(t)||"Введите корректный email"],label:"Email администратора",type:"email",filled:""},null,8,["modelValue","rules"]),a(v,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),rules:[t=>!!t||"Введите пароль",t=>t.length>=6||"Пароль должен содержать минимум 6 символов"],type:r(M)(),class:"q-mt-md",label:"Пароль",filled:""},{append:l(()=>[a(y,{name:r(N)(),class:"cursor-pointer",onClick:r(S)},null,8,["name","onClick"])]),_:1},8,["modelValue","rules","type"])]),_:1},512)]),_:1}),a(te,{align:"right"},{default:l(()=>[a(T,{label:"Отмена",flat:"",onClick:e[4]||(e[4]=t=>f.value=!1)}),a(T,{loading:P.value,color:"primary",label:"Создать",flat:"",onClick:I},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}});export{ue as default};
