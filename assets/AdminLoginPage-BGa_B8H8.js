import{Q as $,a as I}from"./QForm-CjumaL_y.js";import{d as j,Q as A,a as d,c as H,b as J}from"./QDialog-6xVF8BPr.js";import{r as s,j as O,a6 as G,a7 as W,D as X,k as E,m as R,n as l,p as t,E as Y,u as r,q as n,K as v,a8 as Z,J as q}from"./index-Dv7iRb9i.js";import{Q as y}from"./QInput-Cv-SvHr5.js";import{a as ee,b as te}from"./QLayout-DuqvgNil.js";import{e as ae}from"./use-quasar-B7cg2p2u.js";import"./format-BvkBI9bc.js";import"./use-timeout-Bw-UEUPx.js";function L(){const i=s(!1);function o(){i.value=!i.value}function u(){return i.value?"text":"password"}function w(){return i.value?"o_visibility_off":"o_visibility"}function b(){i.value=!1}return{isPasswordVisible:i,togglePasswordVisibility:o,getInputType:u,getToggleIcon:w,resetPasswordVisibility:b}}const le={key:0,class:"text-center"},se={class:"q-mt-lg"},pe=O({name:"AdminLoginPage",__name:"AdminLoginPage",setup(i){const o=G(),u=ae(),{login:w,register:b,loading:h,isAuthenticated:B,initializing:F}=W(),{togglePasswordVisibility:U,getInputType:z,getToggleIcon:D}=L(),{togglePasswordVisibility:K,getInputType:S,getToggleIcon:M}=L(),V=s(),x=s(),m=s(""),g=s(""),p=s(!1),_=s(""),f=s(!1),N=s(!1),P=s(!1),k=s(""),Q=s("");X(()=>{if(B.value){const c=o.currentRoute.value.query.redirect??"/admin";o.push(c);return}N.value=!0});async function C(){if(!V.value||!await V.value.validate())return;p.value=!1,_.value="";const e=await w(m.value,g.value);if(e.success){u.notify({type:"positive",message:"Вход выполнен успешно",position:"top"});const a=o.currentRoute.value.query.redirect??"/admin";o.push(a)}else p.value=!0,_.value=e.error??"Произошла ошибка при входе",u.notify({type:"negative",message:e.error??"Произошла ошибка при входе",position:"top"})}async function T(){if(!x.value||!await x.value.validate())return;P.value=!0;const e=await b(k.value,Q.value);if(e.success){u.notify({type:"positive",message:"Администратор создан успешно",position:"top"}),f.value=!1;const a=o.currentRoute.value.query.redirect??"/admin";o.push(a)}else u.notify({type:"negative",message:e.error??"Произошла ошибка при создании администратора",position:"top"});P.value=!1}return(c,e)=>(R(),E(te,{view:"lHh Lpr lFf"},{default:l(()=>[t(ee,null,{default:l(()=>[t(j,{class:"flex flex-center bg-grey-1"},{default:l(()=>[r(F)?(R(),Y("div",le,[t($,{thickness:.2,class:"q-ma-md",color:"primary",size:"50px",indeterminate:""}),e[6]||(e[6]=n("div",{class:"text-body2 text-grey-8 q-mt-md"}," Инициализация... ",-1))])):(R(),E(A,{key:1,class:"q-pa-lg",style:{"min-width":"400px"}},{default:l(()=>[t(d,{class:"text-center"},{default:l(()=>e[7]||(e[7]=[n("div",{class:"text-h4 text-grey-8 q-mb-md"}," Админка ",-1),n("div",{class:"text-subtitle1 text-grey-6"}," Вход в панель администратора ",-1)])),_:1,__:[7]}),t(d,null,{default:l(()=>[t(I,{ref_key:"formRef",ref:V,onSubmit:C},{default:l(()=>[t(y,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),error:p.value&&!m.value,autocomplete:"username","error-message":"Введите email",label:"Email",type:"email",clearable:"",filled:""},{prepend:l(()=>[t(v,{name:"o_email"})]),_:1},8,["modelValue","error"]),t(y,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),error:p.value&&!g.value,"error-message":_.value||"Введите пароль",type:r(z)(),autocomplete:"current-password",class:"q-mt-md",label:"Пароль",clearable:"",filled:"",onKeyup:Z(C,["enter"])},{prepend:l(()=>[t(v,{name:"o_lock"})]),append:l(()=>[t(v,{name:r(D)(),class:"cursor-pointer",onClick:r(U)},null,8,["name","onClick"])]),_:1},8,["modelValue","error","error-message","type"]),n("div",se,[t(q,{loading:r(h),class:"full-width",color:"primary",label:"Войти",size:"lg",type:"submit"},null,8,["loading"])])]),_:1},512)]),_:1}),t(d,{class:"text-center"},{default:l(()=>e[8]||(e[8]=[n("div",{class:"text-caption text-grey-6"}," Используйте свои учетные данные Firebase Auth ",-1)])),_:1,__:[8]})]),_:1})),t(H,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),persistent:""},{default:l(()=>[t(A,{style:{"min-width":"400px"}},{default:l(()=>[t(d,null,{default:l(()=>e[9]||(e[9]=[n("div",{class:"text-h6"}," Создание администратора ",-1),n("div",{class:"text-caption text-grey-6 q-mt-sm"}," Эта опция доступна только для первоначальной настройки ",-1)])),_:1,__:[9]}),t(d,null,{default:l(()=>[t(I,{ref_key:"registerFormRef",ref:x,onSubmit:T},{default:l(()=>[t(y,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),rules:[a=>!!a||"Введите email",a=>/.+@.+\..+/.test(a)||"Введите корректный email"],label:"Email администратора",type:"email",filled:""},null,8,["modelValue","rules"]),t(y,{modelValue:Q.value,"onUpdate:modelValue":e[3]||(e[3]=a=>Q.value=a),rules:[a=>!!a||"Введите пароль",a=>a.length>=6||"Пароль должен содержать минимум 6 символов"],type:r(S)(),class:"q-mt-md",label:"Пароль",filled:""},{append:l(()=>[t(v,{name:r(M)(),class:"cursor-pointer",onClick:r(K)},null,8,["name","onClick"])]),_:1},8,["modelValue","rules","type"])]),_:1},512)]),_:1}),t(J,{align:"right"},{default:l(()=>[t(q,{label:"Отмена",flat:"",onClick:e[4]||(e[4]=a=>f.value=!1)}),t(q,{loading:P.value,color:"primary",label:"Создать",flat:"",onClick:T},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}});export{pe as default};
