import{r as s,d as $,a1 as H,R as O,a as W,e as I,f as C,p as l,q as t,B as j,a0 as G,D as J,y as i,s as n,a2 as X,P as A,T as d,a3 as L,a4 as v,L as y,a5 as Y,K as T,W as Z,U as ee,C as te}from"./vendor-4cnWJq__.js";import{u as ae}from"./index-CK2exzeq.js";import"./firebase-vendor-DF-ErlKL.js";function B(){const r=s(!1);function o(){r.value=!r.value}function u(){return r.value?"text":"password"}function w(){return r.value?"o_visibility_off":"o_visibility"}function V(){r.value=!1}return{isPasswordVisible:r,togglePasswordVisibility:o,getInputType:u,getToggleIcon:w,resetPasswordVisibility:V}}const le={key:0,class:"text-center"},se={class:"q-mt-lg"},ne=$({name:"AdminLoginPage",__name:"AdminLoginPage",setup(r){const o=H(),u=O(),{login:w,register:V,loading:U,isAuthenticated:h,initializing:E}=ae(),{togglePasswordVisibility:F,getInputType:z,getToggleIcon:D}=B(),{togglePasswordVisibility:K,getInputType:S,getToggleIcon:M}=B(),b=s(),x=s(),m=s(""),g=s(""),p=s(!1),_=s(""),c=s(!1),N=s(!1),P=s(!1),k=s(""),R=s("");W(()=>{if(h.value){const f=o.currentRoute.value.query.redirect??"/admin";o.push(f);return}N.value=!0});async function q(){if(!b.value||!await b.value.validate())return;p.value=!1,_.value="";const e=await w(m.value,g.value);if(e.success){u.notify({type:"positive",message:"Вход выполнен успешно",position:"top"});const a=o.currentRoute.value.query.redirect??"/admin";o.push(a)}else p.value=!0,_.value=e.error??"Произошла ошибка при входе",u.notify({type:"negative",message:e.error??"Произошла ошибка при входе",position:"top"})}async function Q(){if(!x.value||!await x.value.validate())return;P.value=!0;const e=await V(k.value,R.value);if(e.success){u.notify({type:"positive",message:"Администратор создан успешно",position:"top"}),c.value=!1;const a=o.currentRoute.value.query.redirect??"/admin";o.push(a)}else u.notify({type:"negative",message:e.error??"Произошла ошибка при создании администратора",position:"top"});P.value=!1}return(f,e)=>(C(),I(te,{view:"lHh Lpr lFf"},{default:l(()=>[t(j,null,{default:l(()=>[t(G,{class:"flex flex-center bg-grey-1"},{default:l(()=>[i(E)?(C(),J("div",le,[t(X,{thickness:.2,class:"q-ma-md",color:"primary",size:"50px",indeterminate:""}),e[6]||(e[6]=n("div",{class:"text-body2 text-grey-8 q-mt-md"}," Инициализация... ",-1))])):(C(),I(A,{key:1,class:"q-pa-lg",style:{"min-width":"400px"}},{default:l(()=>[t(d,{class:"text-center"},{default:l(()=>e[7]||(e[7]=[n("div",{class:"text-h4 text-grey-8 q-mb-md"}," Админка ",-1),n("div",{class:"text-subtitle1 text-grey-6"}," Вход в панель администратора ",-1)])),_:1,__:[7]}),t(d,null,{default:l(()=>[t(L,{ref_key:"formRef",ref:b,onSubmit:q},{default:l(()=>[t(v,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),error:p.value&&!m.value,autocomplete:"username","error-message":"Введите email",label:"Email",type:"email",clearable:"",filled:""},{prepend:l(()=>[t(y,{name:"o_email"})]),_:1},8,["modelValue","error"]),t(v,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),error:p.value&&!g.value,"error-message":_.value||"Введите пароль",type:i(z)(),autocomplete:"current-password",class:"q-mt-md",label:"Пароль",clearable:"",filled:"",onKeyup:Y(q,["enter"])},{prepend:l(()=>[t(y,{name:"o_lock"})]),append:l(()=>[t(y,{name:i(D)(),class:"cursor-pointer",onClick:i(F)},null,8,["name","onClick"])]),_:1},8,["modelValue","error","error-message","type"]),n("div",se,[t(T,{loading:i(U),class:"full-width",color:"primary",label:"Войти",size:"lg",type:"submit"},null,8,["loading"])])]),_:1},512)]),_:1}),t(d,{class:"text-center"},{default:l(()=>e[8]||(e[8]=[n("div",{class:"text-caption text-grey-6"}," Используйте свои учетные данные Firebase Auth ",-1)])),_:1,__:[8]})]),_:1})),t(Z,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=a=>c.value=a),persistent:""},{default:l(()=>[t(A,{style:{"min-width":"400px"}},{default:l(()=>[t(d,null,{default:l(()=>e[9]||(e[9]=[n("div",{class:"text-h6"}," Создание администратора ",-1),n("div",{class:"text-caption text-grey-6 q-mt-sm"}," Эта опция доступна только для первоначальной настройки ",-1)])),_:1,__:[9]}),t(d,null,{default:l(()=>[t(L,{ref_key:"registerFormRef",ref:x,onSubmit:Q},{default:l(()=>[t(v,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),rules:[a=>!!a||"Введите email",a=>/.+@.+\..+/.test(a)||"Введите корректный email"],label:"Email администратора",type:"email",filled:""},null,8,["modelValue","rules"]),t(v,{modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=a=>R.value=a),rules:[a=>!!a||"Введите пароль",a=>a.length>=6||"Пароль должен содержать минимум 6 символов"],type:i(S)(),class:"q-mt-md",label:"Пароль",filled:""},{append:l(()=>[t(y,{name:i(M)(),class:"cursor-pointer",onClick:i(K)},null,8,["name","onClick"])]),_:1},8,["modelValue","rules","type"])]),_:1},512)]),_:1}),t(ee,{align:"right"},{default:l(()=>[t(T,{label:"Отмена",flat:"",onClick:e[4]||(e[4]=a=>c.value=!1)}),t(T,{loading:P.value,color:"primary",label:"Создать",flat:"",onClick:Q},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}});export{ne as default};
